<!DOCTYPE html5>
<html lang="en">
<head>
	<meta charset= "utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="style/search.css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>

  <div class="container">
		<a href="employeehome.html">
    	<img src="style/logo.png" class="logo">
		</a>
    <a href="index.html">
      <img src="style/logout.png" class="logout">
    </a>

    <p id="name" for="name"></p>
    <hr>

    <div id="searchBar">
        <input type="text" class="search" id="accountIban" placeholder="Search with Iban">
        <input type="submit" class="submit" id="search" value="Search">
    </div>

    <div class="flex-container">
        <div class="box">
            <div id="info"></div>
    		</div>
  	</div>
	</div>

</body>
</html>

<script type="text/javascript">
	var loggedInUser = JSON.parse(sessionStorage.getItem("loggedInUser"));
	$('#name').text(loggedInUser.firstname + " " + loggedInUser.lastname);

	$(document).ready(function() {
		$("#search").click(function(){
			var name = $('#accountIban').val().trim();
				$.ajax({
					url: 'http://localhost:8080/accounts/search',
					type:'get',
					data:{name:name},
					contentType:"application/json",
					dataType:"json",
					success:function(response){
						var message = "";
						$.each(response, function(index){
							fillData(response[index]);
						});
					},
					error: function(error){
						alert("No account found with that Iban")
					}
				});
		});
	});

	function fillData(account)
	{
		var html = `<div class="block">
										<h3>` + Account.TypeofaccountEnum `</h3>
										<hr>
										<p>` + getNames(account) `</p>
										<p>` + Account.iban `</p>
										<p>` + Account.balance `</p>
										<button id="` + Account.userId + `" class="btn">Check transactions</button>
								</div>`
		$("#info").append(html);
		// Using getNames function to retrieve first and last name of account holder through the saved
		// userID in account object
		document.getElementById(Account.userId).addEventListener("click",function(){
			sessionStorage.setItem('foundAccount', JSON.stringify(account));
			window.location = "transactionView.html";
		});
	}

	function getNames(account)
	{
		var id = account.userId.val().trim();
			$.ajax({
				url:'http://localhost:8080/users/search',
				type:'get',
				data:{name:name},
				contentType: "application/json",
				dataType:"json",
				success:function(response){
					var msg = "";
					$.each(response,function(index){
						fillNames(response[index]);
					});
				},
				error: function(error){
					alert("No user found with that name");
				}
			});
	}

	function fillNames(user){
		return user.firstname + " " + user.lastname;
	}
</script>
